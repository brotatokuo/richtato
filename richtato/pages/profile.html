{% extends 'base.html' %} {% load static %}
{% block title %}Profile{% endblock %}
{% block content %}
<div class="main-content">
  <div class="title">
    <h1>Profile</h1>
  </div>

  <!-- Profile Header Section -->
  <div class="profile-header">
    <div class="profile-avatar-section">
      <div class="profile-avatar">
        <img src="{% static 'images/avatar.png' %}" alt="Profile Avatar" />
        <div class="avatar-overlay">
          <i class="fa-solid fa-camera"></i>
        </div>
      </div>
      <div class="profile-header-info">
        <h2>{{ user.username }}</h2>
        <p class="profile-email">{{ user.email }}</p>
        <div class="profile-badges">
          {% if user.is_demo %}
            <span class="badge demo-badge">
              <i class="fa-solid fa-flask"></i>
              Demo User
            </span>
          {% endif %}
          <span class="badge member-since-badge">
            <i class="fa-solid fa-calendar"></i>
            Member since {{ user.date_joined|date:"M Y" }}
          </span>
        </div>
      </div>
    </div>
    <div class="profile-stats">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa-solid fa-chart-line"></i>
        </div>
        <div class="stat-info">
          <h3>{{ total_transactions }}</h3>
          <p>Total Transactions</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa-solid fa-wallet"></i>
        </div>
        <div class="stat-info">
          <h3>{{ total_accounts }}</h3>
          <p>Connected Accounts</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa-solid fa-calendar-days"></i>
        </div>
        <div class="stat-info">
          <h3>{{ days_active }}</h3>
          <p>Days Active</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Content Grid -->
  <div class="profile-content-grid">

    <!-- Account Information Card -->
    <div class="profile-card">
      <div class="card-header">
        <h3>
          <i class="fa-solid fa-user"></i>
          Account Information
        </h3>
      </div>
      <div class="card-content">
        <div class="info-group">
          <label>Username</label>
          <div class="editable-field">
            <span id="username-display">{{ user.username }}</span>
            <button class="edit-btn" onclick="editField('username')" data-field="username">
              <i class="fa-solid fa-edit"></i>
            </button>
          </div>
          <div class="edit-form" id="username-edit" style="display: none;">
            <input type="text" id="username-input" value="{{ user.username }}" />
            <div class="edit-actions">
              <button class="save-btn" onclick="saveField('username')">Save</button>
              <button class="cancel-btn" onclick="cancelEdit('username')">Cancel</button>
            </div>
          </div>
        </div>

        <div class="info-group">
          <label>Email Address</label>
          <div class="static-field">
            <span>{{ user.email }}</span>
          </div>
        </div>

        <div class="info-group">
          <label>User ID</label>
          <div class="static-field">
            <span class="user-id">#{{ user.id }}</span>
          </div>
        </div>

        <div class="info-group">
          <label>Account Type</label>
          <div class="static-field">
            <span class="account-type">
              {% if user.is_demo %}
                <i class="fa-solid fa-flask"></i> Demo Account
              {% else %}
                <i class="fa-solid fa-user-check"></i> Regular Account
              {% endif %}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Security Settings Card -->
    <div class="profile-card">
      <div class="card-header">
        <h3>
          <i class="fa-solid fa-shield-halved"></i>
          Security Settings
        </h3>
      </div>
      <div class="card-content">
        <div class="info-group">
          <label>Password</label>
          <div class="static-field">
            <span>••••••••••••</span>
            <button class="edit-btn" onclick="changePassword()">
              <i class="fa-solid fa-key"></i>
              Change Password
            </button>
          </div>
        </div>

        <div class="info-group">
          <label>Last Login</label>
          <div class="static-field">
            <span>{{ user.last_login|date:"M d, Y g:i A" }}</span>
          </div>
        </div>

        <div class="info-group">
          <label>Account Created</label>
          <div class="static-field">
            <span>{{ user.date_joined|date:"M d, Y g:i A" }}</span>
          </div>
        </div>
      </div>
    </div>


    <!-- Preferences Card -->
    <div class="profile-card">
      <div class="card-header">
        <h3>
          <i class="fa-solid fa-sliders"></i>
          Preferences
        </h3>
      </div>
      <div class="card-content">
        <div class="preference-group">
          <label class="preference-label">
            <input type="checkbox" id="email-notifications" {% if user.email_notifications %}checked{% endif %}>
            <span class="checkmark"></span>
            Email Notifications
          </label>
          <small>Receive email alerts for important account activities</small>
        </div>

        <div class="preference-group">
          <label class="preference-label">
            <input type="checkbox" id="data-insights" {% if user.data_insights %}checked{% endif %}>
            <span class="checkmark"></span>
            Monthly Insights
          </label>
          <small>Get personalized spending insights and recommendations</small>
        </div>

        <div class="preference-group">
          <label for="currency">Preferred Currency</label>
          <select id="currency" class="preference-select">
            <option value="USD" selected>USD ($)</option>
            <option value="EUR">EUR (€)</option>
            <option value="GBP">GBP (£)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Danger Zone Card -->
    {% if not user.is_demo %}
    <div class="profile-card danger-card">
      <div class="card-header">
        <h3>
          <i class="fa-solid fa-triangle-exclamation"></i>
          Danger Zone
        </h3>
      </div>
      <div class="card-content">
        <div class="danger-action">
          <div class="danger-info">
            <h4>Delete Account</h4>
            <p>Permanently delete your account and all associated data. This action cannot be undone.</p>
          </div>
          <button class="danger-btn" onclick="confirmDeleteAccount()">
            Delete Account
          </button>
        </div>
      </div>
    </div>
    {% endif %}

  </div>
</div>

<!-- Password Change Modal -->
<div id="password-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Change Password</h3>
      <button class="modal-close" onclick="closePasswordModal()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form id="password-form">
        <div class="form-group">
          <label for="current-password">Current Password</label>
          <input type="password" id="current-password" required>
        </div>
        <div class="form-group">
          <label for="new-password">New Password</label>
          <input type="password" id="new-password" required>
          <small>Password must be at least 8 characters long</small>
        </div>
        <div class="form-group">
          <label for="confirm-password">Confirm New Password</label>
          <input type="password" id="confirm-password" required>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="cancel-btn" onclick="closePasswordModal()">Cancel</button>
      <button class="save-btn" onclick="submitPasswordChange()">Change Password</button>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script src="{% static 'js/pages/profile.js' %}"></script>
{% endblock %}
