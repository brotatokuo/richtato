{% extends 'base.html' %} {% load static %}
<!-- prettier-ignore-start -->
{% block title %}Dashboard {%endblock %}
<!-- prettier-ignore-start -->
{% block content %}
<div class="main-content">
  <div class="title">
    <h1>Dashboard</h1>
  </div>

  <!-- KPI Summary Row -->
  <div class="kpi-row">
    <div class="kpi-card">
      <div class="kpi-header">
        <h3>Net Worth</h3>
        <i class="fa-solid fa-chart-line kpi-icon"></i>
      </div>
      <div class="kpi-value currency">{{ networth }}</div>
      <div class="kpi-change {% if networth_growth_class %}{{ networth_growth_class }}{% endif %}">
        {{ networth_growth }}
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-header">
        <h3>Savings Rate</h3>
        <i class="fa-solid fa-piggy-bank kpi-icon"></i>
      </div>
      <div class="kpi-value">{{ savings_rate }}</div>
      <div class="kpi-change {% if savings_rate_class %}{{ savings_rate_class }}{% endif %}">
        {{ savings_rate_context }}
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-header">
        <h3>Budget Utilization</h3>
        <i class="fa-solid fa-gauge-high kpi-icon"></i>
      </div>
      <div class="kpi-value">{{ budget_utilization_30_days }}</div>
      <div class="kpi-change">of current month's budget</div>
    </div>

    <div class="kpi-card">
      <div class="kpi-header">
        <h3>Non-Essential Spending</h3>
        <i class="fa-solid fa-percent kpi-icon"></i>
      </div>
      <div class="kpi-value">{{ nonessential_spending_pct }}%</div>
      <div class="kpi-change">of total spending</div>
    </div>
  </div>

  <!-- Main Analytics Grid -->
  <div class="analytics-grid">
    <!-- Budget Progress -->
    <div class="analytics-card large">
      <div class="card-header">
        <h2>Budget Progress</h2>
      </div>
      <div class="budget-categories-container" id="categories-container">
        <!-- Categories will be inserted here dynamically -->
      </div>
    </div>
    <!-- Cash Flow Trend -->
    <!-- <div class="analytics-card large">
      <div class="card-header">
        <h2>Cash Flow Trend</h2>
        <div class="card-controls">
          <select id="cashflow-period">
            <option value="6m">Last 6 months</option>
            <option value="1y">Last year</option>
            <option value="all">All time</option>
          </select>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="cashFlowChart"></canvas>
      </div>
    </div> -->

    <!-- Income vs Expenses -->
    <div class="analytics-card">
      <div class="card-header">
        <h2>Income vs Expenses</h2>
      </div>
      <div class="chart-container">
        <canvas id="incomeExpenseChart"></canvas>
      </div>
    </div>

    <!-- Savings Trend -->
    <div class="analytics-card">
      <div class="card-header">
        <h2>Savings Accumulation</h2>
      </div>
      <div class="chart-container">
        <canvas id="savingsChart"></canvas>
      </div>
    </div>

    <!-- Top Categories -->
    <div class="analytics-card">
      <div class="card-header">
        <h2>Top Spending Categories</h2>
        <div class="card-controls">
          <select id="categories-period">
            <option value="30d">Last 30 days</option>
            <option value="3m">Last 3 months</option>
            <option value="6m">Last 6 months</option>
            <option value="1y">Last year</option>
            <option value="all">All time</option>
          </select>
        </div>
      </div>
      <div class="categories-container">
        <!-- Categories list view -->
        <div class="categories-list" id="top-categories">
          <!-- Top categories will be populated here -->
        </div>
      </div>
    </div>

    <!-- Expense Breakdown Pie Chart -->
    <div class="analytics-card">
      <div class="card-header">
        <h2>Expense Breakdown</h2>
        <div class="card-controls">
          <select id="expense-categories-year"></select>
          <select id="expense-categories-month">
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="expensePieChart"></canvas>
      </div>
      <div class="chart-legend" id="expense-legend"></div>
    </div>

    <div class="analytics-card large">
      <div class="card-header">
        <h2>Accounts</h2>
      </div>
      <div class="categories-table-container" id="assets-container">
        <!-- Assets list view -->
        <div class="categories-list" id="assets-list">
          <!-- Assets list will be populated here -->
        </div>
        <!-- Assets table view -->
        <div class="categories-table-container" id="assets-table">
          <!-- Assets table will be populated here -->
        </div>
      </div>
    </div>

    <!-- Cash Flow -->
    <div class="analytics-card large">
      <div class="card-header">
        <h2>Cash Flow</h2>
      </div>
      <div class="chart-container sankey-container" id="sankey-cash-flow">
        <!-- Sankey chart will be rendered here by JavaScript -->
      </div>
    </div>

    <!-- Include Chart.js and plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

    <!-- Dashboard Scripts -->
    <script src="{% static 'js/components/budgetRenderer.js' %}"></script>
    <script src="{% static 'js/components/timeseriesGraph.js' %}"></script>
    <script src="{% static 'js/pages/dashboard.js' %}"></script>
    {% endblock %}
  </div>
</div>
